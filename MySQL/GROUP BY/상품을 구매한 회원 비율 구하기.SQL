WITH JOIN2021 AS (
    SELECT
    USER_ID
    FROM USER_INFO
    WHERE YEAR(JOINED) = 2021
), TMP AS (
    SELECT 
    USER_ID,
    YEAR(SALES_DATE) AS YEAR,
    MONTH(SALES_DATE) AS MONTH 
    FROM ONLINE_SALE 
    WHERE 
    USER_ID IN (
        SELECT USER_ID
        FROM JOIN2021
    )
    GROUP BY USER_ID, YEAR(SALES_DATE), MONTH(SALES_DATE)
)

SELECT 
YEAR,
MONTH,
COUNT(*) AS PURCHASED_USERS,
ROUND(
    COUNT(*) / 
    (
        SELECT 
        COUNT(*)
        FROM JOIN2021
    )
, 1) AS PUCHASED_RATIO
FROM TMP
GROUP BY MONTH
ORDER BY YEAR, MONTH